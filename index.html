<div class="main-container">
    <div class="card">
        </div>
    <div id="brain-viewport" style="flex: 1; height: 600px; min-width: 400px;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
    const container = document.getElementById('brain-viewport');
    
    // 1. Cena e Câmera
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.z = 5;

    // 2. Renderizador (com Alpha para não ficar preto)
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // 3. O "Motor de Brilho" (Composer)
    const composer = new THREE.EffectComposer(renderer);
    const renderPass = new THREE.RenderPass(scene, camera);
    composer.addPass(renderPass);

    const bloomPass = new THREE.UnrealBloomPass(
        new THREE.Vector2(container.clientWidth, container.clientHeight), 
        1.5, 0.4, 0.85
    );
    bloomPass.threshold = 0.1;
    bloomPass.strength = 1.2; // Brilho inicial
    composer.addPass(bloomPass);

    // 4. Luzes (Importante para o material brilhar)
    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    const pointLight = new THREE.PointLight(0xff0000, 2);
    pointLight.position.set(5, 5, 5);
    scene.add(pointLight);

    // 5. Carregar o Cérebro
    let brain, brainMat;
    const loader = new THREE.GLTFLoader();
    
    // TENTATIVA DE CARREGAMENTO
    loader.load('human-brain.glb', (gltf) => {
        brain = gltf.scene;
        brain.traverse(c => {
            if(c.isMesh) {
                c.material = new THREE.MeshStandardMaterial({
                    color: 0x050000, // Base escura para destacar a aura
                    emissive: 0xff0000, 
                    emissiveIntensity: 0.8,
                    metalness: 1, roughness: 0.2
                });
                brainMat = c.material;
            }
        });
        
        // Centraliza automaticamente
        const box = new THREE.Box3().setFromObject(brain);
        const center = box.getCenter(new THREE.Vector3());
        brain.position.sub(center);
        
        scene.add(brain);
        console.log("Cérebro carregado com sucesso!");
    }, undefined, (err) => {
        console.error("ERRO NO ARQUIVO GLB: Verifique se o nome 'human-brain.glb' está correto na pasta.", err);
    });

    // 6. Animação e Brilho ao digitar
    document.getElementById('idInput').addEventListener('input', () => {
        if(bloomPass) {
            bloomPass.strength = 7.0; // Flash ultra forte
            setTimeout(() => { bloomPass.strength = 1.2; }, 150);
        }
    });

    function animate() {
        requestAnimationFrame(animate);
        if(brain) {
            brain.rotation.y += 0.003; // Rotação suave
        }
        composer.render(); // SEMPRE RENDERIZAR PELO COMPOSER
    }
    animate();

    // Ajuste de tela
    window.addEventListener('resize', () => {
        const w = container.clientWidth;
        const h = container.clientHeight;
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
        renderer.setSize(w, h);
        composer.setSize(w, h);
    });
</script>

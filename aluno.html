<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>UnintaBot - Terminal Neural</title>
    <style>
        :root { --ia-cyan: #00f2ff; --primary-red: #e30613; --bg-dark: #050a14; }
        body { background: var(--bg-dark); color: white; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; margin: 0; overflow: hidden; }
        header { background: var(--primary-red); padding: 15px; text-align: center; font-weight: bold; }
        #brain-container { flex: 1; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #0a1a2f 0%, #050a14 100%); }
        #chat-display { padding: 15px; background: rgba(0, 0, 0, 0.8); color: var(--ia-cyan); min-height: 80px; max-height: 150px; overflow-y: auto; border-left: 4px solid var(--ia-cyan); margin: 10px 20px; border-radius: 4px; font-size: 14px; }
        .control-panel { background: #0d1117; padding: 20px; border-top: 1px solid var(--ia-cyan); }
        .input-box { display: flex; gap: 10px; max-width: 800px; margin: 0 auto; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid var(--ia-cyan); background: #000; color: white; outline: none; }
        button { background: var(--primary-red); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        #btnMicrofone { background: #222; border: 1px solid var(--ia-cyan); }
    </style>
</head>
<body>

<header>SISTEMA NEURAL UNINTA</header>
<div id="brain-container">
    <div style="color: var(--ia-cyan); font-size: 12px; border: 1px solid; padding: 10px;">CÃ‰REBRO 3D ATIVO</div>
</div>
<div id="chat-display">Pronto para anÃ¡lise, Mestre Matheus.</div>

<div class="control-panel">
    <div class="input-box">
        <button id="btnMicrofone" onclick="ouvir()">ðŸŽ¤</button>
        <input type="text" id="userInput" placeholder="Digite sua ordem aqui...">
        <button id="btnEnviar" onclick="enviar()">EXECUTAR</button>
    </div>
</div>

<script>
    const API_KEY = "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";

    // FUNÃ‡ÃƒO DE VOZ SEM TRAVAMENTOS
    function falar(texto) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(texto);
        const voices = window.speechSynthesis.getVoices();
        
        // Busca voz de homem ou engrossa a que tiver
        let vMacho = voices.find(v => v.name.includes('Antonio') || v.name.includes('Daniel') || v.name.includes('Male'));
        if (vMacho) {
            msg.voice = vMacho;
            msg.pitch = 0.8;
        } else {
            msg.pitch = 0.4; // Engrossa voz feminina no Chrome/Opera
        }
        
        msg.lang = 'pt-BR';
        msg.rate = 0.9;
        window.speechSynthesis.speak(msg);
    }

    // FUNÃ‡ÃƒO ENVIAR (BLINDADA)
    async function enviar() {
        const input = document.getElementById('userInput');
        const display = document.getElementById('chat-display');
        const pergunta = input.value.trim();

        if (!pergunta) return;

        display.innerText = "Processando pergunta do Mestre Matheus...";
        input.value = ""; // Limpa logo para evitar duplo clique

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { 
                    "Authorization": "Bearer " + API_KEY,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [
                        { role: "system", content: "VocÃª Ã© o UnintaBot. Responda de forma curta, masculina e tÃ©cnica." },
                        { role: "user", content: pergunta }
                    ]
                })
            });

            const data = await response.json();
            if (data.choices && data.choices[0]) {
                const resposta = data.choices[0].message.content;
                display.innerText = "UnintaBot: " + resposta;
                falar(resposta);
            } else {
                display.innerText = "Erro: API retornou vazio.";
            }

        } catch (err) {
            console.error(err);
            display.innerText = "Erro de conexÃ£o. Verifique sua internet.";
        }
    }

    // MICROFONE
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (Recognition) {
        const recognition = new Recognition();
        recognition.lang = 'pt-BR';
        recognition.onresult = (e) => {
            document.getElementById('userInput').value = e.results[0][0].transcript;
            enviar();
        };
        window.ouvir = () => recognition.start();
    }

    // ENTER PARA ENVIAR
    document.getElementById('userInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') enviar();
    });

    // Carrega vozes em segundo plano para nÃ£o travar o inÃ­cio
    window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
</script>
</body>
</html>

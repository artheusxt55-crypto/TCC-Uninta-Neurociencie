<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratório de Neurociência - Mestre Matheus</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #chat-container { width: 100%; max-width: 500px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; }
        #messages { height: 300px; overflow-y: auto; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; }
        .msg { margin: 5px 0; padding: 8px 12px; border-radius: 10px; }
        .user { background: #007bff; color: white; align-self: flex-end; text-align: right; }
        .bot { background: #e9ecef; color: #333; }
        input { width: 80%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; }
        button { padding: 10px; border: none; background: #28a745; color: white; border-radius: 5px; cursor: pointer; }
        .mestre-label { font-size: 0.8em; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="chat-container">
        <div class="mestre-label">Propriedade Intelectual: <b>Mestre Matheus</b> (UNINTA)</div>
        <div id="messages"></div>
        <input type="text" id="userInput" placeholder="Perunte sobre Neuroimagem ou TDAH...">
        <button onclick="enviar()">Enviar</button>
    </div>

    <script>
        const API_TOKEN = "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";
        const MODELO = "mistralai/Mistral-7B-v0.1";

        // Função para a IA falar
        function falar(texto) {
            const vozes = window.speechSynthesis.getVoices();
            const mensagem = new SpeechSynthesisUtterance(texto);
            mensagem.lang = 'pt-BR';
            // Tenta pegar uma voz brasileira natural se disponível
            const vozBR = vozes.find(v => v.lang.includes('PT-BR'));
            if(vozBR) mensagem.voice = vozBR;
            window.speechSynthesis.speak(mensagem);
        }

        async function enviar() {
            const input = document.getElementById('userInput');
            const msgDiv = document.getElementById('messages');
            if (!input.value) return;

            // Exibe mensagem do usuário
            msgDiv.innerHTML += `<div class="msg user"><b>Você:</b> ${input.value}</div>`;
            
            const promptMestre = `Você é a IA proprietária do Laboratório de Neurociência do Mestre Matheus na UNINTA. 
            Responda sempre em Português do Brasil. Seja técnico e acadêmico. 
            Fale com autoridade sobre Neuroimagem, TDAH e Neurociências. 
            Sempre que possível, cite a USP, UFRGS ou CBI of Miami como referências. 
            Pergunta do aluno: ${input.value}`;

            input.value = "Pensando...";

            try {
                const response = await fetch(`https://api-inference.huggingface.co/models/${MODELO}`, {
                    headers: { Authorization: `Bearer ${API_TOKEN}`, "Content-Type": "application/json" },
                    method: "POST",
                    body: JSON.stringify({ inputs: promptMestre, parameters: { max_new_tokens: 250, return_full_text: false } }),
                });

                const data = await response.json();
                let respostaTexto = data[0].generated_text || "Mestre, estou processando...";
                
                // Limpa a resposta de códigos e exibe
                msgDiv.innerHTML += `<div class="msg bot"><b>IA do Mestre:</b> ${respostaTexto}</div>`;
                input.value = "";
                msgDiv.scrollTop = msgDiv.scrollHeight;

                // Faz a IA falar
                falar(respostaTexto);

            } catch (error) {
                msgDiv.innerHTML += `<div class="msg bot">Erro ao conectar com o laboratório.</div>`;
                input.value = "";
            }
        }
    </script>
</body>
</html>

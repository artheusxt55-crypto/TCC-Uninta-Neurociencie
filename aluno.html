<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnintaBot - Neural Analytics Ultra</title>
    <style>
        :root { --ia-cyan: #00f2ff; --primary-red: #e30613; --bg-dark: #010409; --panel-bg: rgba(13, 17, 23, 0.95); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
        body { background: var(--bg-dark); color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        header { padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary-red); background: #000; z-index: 100; }
        
        #main-viewport { flex: 1; position: relative; display: flex; overflow: hidden; }
        
        /* Painel Lateral */
        #history-panel { width: 220px; border-right: 1px solid rgba(0, 242, 255, 0.1); background: rgba(0,0,0,0.8); padding: 20px; z-index: 10; }
        
        /* Cérebro 3D */
        #brain-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }

        /* Display de Chat */
        #chat-display { position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 850px; padding: 25px; background: var(--panel-bg); border-left: 4px solid var(--ia-cyan); color: #ddd; font-size: 14px; max-height: 180px; overflow-y: auto; z-index: 10; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }

        /* Controles */
        .control-panel { padding: 30px; background: #000; border-top: 1px solid #1a1a1a; z-index: 100; position: relative; }
        .input-box { display: flex; gap: 15px; max-width: 1000px; margin: 0 auto; align-items: center; }
        
        input { flex: 1; padding: 18px; border-radius: 8px; border: 1px solid #333; background: #050505; color: var(--ia-cyan); outline: none; font-size: 16px; z-index: 110; }
        .btn-analyze { height: 58px; border-radius: 8px; border: none; background: var(--primary-red); color: white; padding: 0 30px; font-weight: 800; cursor: pointer; z-index: 110; transition: 0.3s; }
        .btn-analyze:hover { background: #ff1a1a; transform: scale(1.02); }
        
        #loading-bar { height: 3px; background: var(--ia-cyan); width: 0%; transition: 0.4s; position: absolute; bottom: 0; left: 0; }
        
        .voice-hub { position: absolute; right: 25px; top: 25px; z-index: 20; display: flex; flex-direction: column; gap: 8px; }
        .voice-card { padding: 10px 18px; font-size: 10px; border: 1px solid var(--ia-cyan); background: rgba(0,0,0,0.8); cursor: pointer; color: var(--ia-cyan); border-radius: 4px; }
        .voice-card.active { background: var(--ia-cyan); color: black; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 14px; font-weight: 900; letter-spacing: 4px;">UNINTA <span style="color:var(--primary-red)">NEURAL_ACADEMY</span></div>
    <div style="font-size: 10px; color: var(--ia-cyan)">CORE_V6_ULTRALINK</div>
</header>

<div id="main-viewport">
    <aside id="history-panel">
        <div style="font-size: 9px; color: #444; margin-bottom: 15px;">DATABASE_LOGS</div>
        <div id="logs" style="font-size: 10px; color: var(--ia-cyan)">SINAPSES: ONLINE</div>
    </aside>

    <div class="voice-hub">
        <div id="v-fish" class="voice-card active" onclick="setVoice('fish', this)">FISH_S1_ULTRA</div>
        <div id="v-native" class="voice-card" onclick="setVoice('google', this)">NATIVE_OS</div>
    </div>

    <div id="brain-container"></div>
    <div id="chat-display">>> [SISTEMA]: CONEXÃO ESTABELECIDA COM A NOVA CHAVE. AGUARDANDO COMANDO...<div id="loading-bar"></div></div>
</div>

<div class="control-panel">
    <div class="input-box">
        <input type="text" id="userInput" placeholder="Digite sobre TDAH, TEA ou Neuroimagem..." autocomplete="off">
        <button id="btnEnviar" class="btn-analyze">EXECUTAR SCANNER ⚡</button>
    </div>
</div>

<script type="importmap">
    { "imports": { 
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", 
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/" 
    } }
</script>

<script type="module">
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    // SUA NOVA CHAVE APLICADA
    const GROQ_API = "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";

    const input = document.getElementById('userInput');
    const display = document.getElementById('chat-display');
    const bar = document.getElementById('loading-bar');

    // Inicialização do Cérebro 3D
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('brain-container').appendChild(renderer.domElement);
    camera.position.z = 5;

    let brain, isAnalyzing = false;
    new GLTFLoader().load('./brainunt.glb', (gltf) => {
        brain = gltf.scene;
        brain.scale.set(2, 2, 2);
        scene.add(brain);
    }, undefined, (e) => console.error("Erro ao carregar brainunt.glb"));

    function animate() {
        requestAnimationFrame(animate);
        if(brain) brain.rotation.y += 0.005;
        renderer.render(scene, camera);
    }
    animate();

    async function enviar() {
        const txt = input.value.trim();
        if(!txt || isAnalyzing) return;

        isAnalyzing = true;
        input.disabled = true;
        display.innerHTML = ">> [PROCESSANDO NA GROQ CLOUD...]";
        bar.style.width = "50%";

        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { 
                    "Authorization": `Bearer ${GROQ_API}`, 
                    "Content-Type": "application/json" 
                },
                body: JSON.stringify({ 
                    model: "llama-3.3-70b-versatile", 
                    messages: [
                        {role: "system", content: "Você é o UnintaBot, focado em Neurociência, TDAH e TEA. Seja técnico e preciso."}, 
                        {role: "user", content: txt}
                    ] 
                })
            });

            const data = await res.json();
            const resp = data.choices[0].message.content;
            
            bar.style.width = "100%";
            display.innerHTML = `>> [ANÁLISE]: ${resp}`;
            
            // Voz Nativa
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(resp.replace(/[*#]/g, ''));
            msg.lang = 'pt-BR';
            window.speechSynthesis.speak(msg);

        } catch(e) { 
            display.innerHTML = ">> [ERRO]: FALHA NA CONEXÃO. VERIFIQUE O CONSOLE."; 
            console.error(e);
        } finally {
            setTimeout(() => {
                isAnalyzing = false;
                input.disabled = false;
                input.value = "";
                input.focus();
                bar.style.width = "0%";
            }, 1000);
        }
    }

    document.getElementById('btnEnviar').onclick = enviar;
    input.onkeypress = (e) => { if(e.key === 'Enter') enviar(); };

    window.setVoice = (mode, el) => {
        document.querySelectorAll('.voice-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    };
</script>
</body>
</html>
